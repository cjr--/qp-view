define(module,function(e,t,i){var n=t("qp-utility");i({ns:"qp-view/view",element:null,model:null,node:null,init:function(e){e=n.options(e,{auto:!0,bind:!0,draw:!0}),this.model=e.model,this.element=n.element(e.el||e.element),this.node={element:this.element,bindings:[]},e.auto&&(e.bind&&this.bind(),e.bind&&e.update_view&&this.update_view())},bind:function(){this.parse(this.node)},update_view:function(e){this.sync("view",this.node,this.model,e)},update_model:function(e){this.sync("model",this.node,this.model,e)},sync:function(e,t,i,a){a&&t.name!==a||(a=null,n.each(t.bindings,function(t){t["update_"+e].call(this,i)},this)),n.each(t.children,function(s,o){if(t.each){var l=n.find(t.bindings,{name:"each"});i[l.item_name]=i[l.path][o]}this.sync(e,s,i,a),t.each&&n["delete"](i,l.item_name)},this)},parse:function(e){return n.has_attr(e.element,"v-view")?(debug("view.bind @",n.attr(e.element,"v-view")),e.element.removeAttribute("v-view"),e):(this.parse_node(e),e.element.parentNode&&(e.children=n.select(n.to_array(e.element.children),function(t){if(n.is_element(t)){if(!t.hasAttribute("v-each"))return this.parse({element:t,bindings:[]});e.parent=e.element,e.element=t,e.each=!0,this.parse_node(e)}},this)),e)},parse_node:function(e){n.each(n.get_attributes(e.element),function(t){if("v-"===t.name.slice(0,2)){var i=this.create_binding(e,t);if(e.element.removeAttribute(i.key),"node"===i.name)e.name=i.path;else if("if"===i.name)i.type="if";else if(n["in"](i.name,"show","hide"))i.type="visible",i.show="show"===i.name,i.hide=!i.show;else if(n["in"](i.name,"readonly","disabled"))i.attribute=i.name,i["boolean"]=!0;else if("text"===i.name)i.property="textContent";else if("html"===i.name)i.property="innerHTML";else if("value"===i.name)i.property="value";else if("template"===i.name)i.type="template";else if("each"===i.name){var a=i.path.split(" in ");i.item_name=a[0],i.path=a[1],i.template=e.parent.removeChild(e.element),e.element=e.parent,delete e.parent}else"add-class"===i.name?i.type="add_class":n.match(i.name,"on-*")?(i.type="on",i.event=i.name.slice(3)):n.match(i.name,"class-*")?(i.type="class",i["class"]=i.name.slice(6)):n.match(i.name,"style-*")?(i.type="style",i.style=i.name.slice(6)):i.attribute=i.type;i.ignore||(i.property?this.property(i,e.element):i.attribute?this.attribute(i,e.element):"each"===i.name?this.each(i,e):this[i.type](i,e.element))}}.bind(this))},create_binding:function(e,t){var i=t.name.slice(2),a={key:t.name,name:i,type:i,path:t.value,negate:!1,priority:99};return n.match(a.path,"not *")&&(a.path=t.value.slice(4),a.negate=!0),n.match(a.path,"app.*")&&(a.path="global."+a.path),n["in"](a.type,"node","page")?e.ignore=!0:e.bindings.push(a),a},"if":function(e,t){e.priority=1},visible:function(e,t){e.update_view=function(i){var a=n.get(i,e.path);e.show&&a||e.hide&&!a?n.show(t,"auto"):n.hide(t,"none")},e.update_model=function(i){n.set(i,e.path,"none"!==t.style.display&&e.show)}},"class":function(e,t){e.update_view=function(i){n.get(i,e.path)?n.add_class(t,e["class"]):n.remove_class(t,e["class"])},e.update_model=function(i){n.set(i,e.path,n.has_class(t))}},add_class:function(e,t){e.update_view=function(i){n.add_class(t,n.get(i,e.path))},e.update_model=function(e){}},style:function(e,t){e.update_view=function(i){n.set_style(t,e.style,n.get(i,e.path))},e.update_model=function(i){n.set(i,e.path,n.get_style(t,e.style))}},template:function(e,t){e.update_view=function(i){t.textContent=n.format(e.path,i)},e.update_model=function(e){}},property:function(e,t){e.update_view=function(i){t[e.property]=n.get(i,e.path)},e.update_model=function(i){n.set(i,e.path,t[e.property])}},attribute:function(e,t){e["boolean"]?(e.update_view=function(i){n.get(i,e.path)?t.setAttribute(e.attribute):t.removeAttribute(e.attribute)},e.update_model=function(i){n.set(i,e.path,t.hasAttribute(e.attribute))}):(e.update_view=function(i){t.setAttribute(e.attribute,n.get(i,e.path))},e.update_model=function(i){n.set(i,e.path,t.getAttribute(e.attribute))})},on:function(e,t){e.update_view=function(i){e.bound||(n["in"](e.event,"keyup","keydown")?e.event_listener=function(t){n.get(i,e.path).call(i,t)}:n["in"](e.event,"submit")?e.event_listener=function(t){return n.nodefault(t),n.get(i,e.path).call(i,t.target),!1}:n["in"](e.event,"click")&&(e.event_listener=function(a){n.nodefault(a);var s=t.getAttribute("data-id");s||(s=n.parents_until(a.target,t,function(e){return e.getAttribute("data-id")})),n.get(i,e.path).call(i,Number(s))}),n.on(t,e.event,e.event_listener||n.noop),e.bound=!0)},e.update_model=function(e){}},each:function(e,t){var i=t.element;e.update_view=function(a){i.innerHTML="",t.children=n.map(n.get(a,e.path),function(t){var n=e.template.cloneNode(!0);return n.setAttribute("data-id",t.id),i.appendChild(n),this.parse({element:n,bindings:[]})},this)},e.update_model=function(e){}}})}),define(module,function(e,t,i){var n=t("qp-utility"),a=t("qp-utility/store");i({ns:"qp-view/controller",views:[],history:[],add_view:function(e){if(this.views.push({key:e.key,ctor:e.ctor,el:e.el}),e.auto){var t=n.find(this.views,{key:e.key});t&&(this.history.push(t),this.show_view(e))}},toggle_view:function(e){var t=n.find(this.views,{key:e.key});t&&(t.instance&&t.instance.visible?this.hide_view(e):this.show_view(e))},next_view:function(e){var t=this.history[this.history.length-1];t&&this.hide_view({key:t.key});var i=n.find(this.views,{key:e.key});i&&(this.history.push(i),this.show_view(e))},get_current_view:function(){var e=this.history[this.history.length-1];return e?e.instance.controller===this?e.instance:e.instance.controller.get_current_view():void 0},back_view:function(e){var t=this.history[this.history.length-1];if(t){if(t.instance.controller!==this)return void t.instance.controller.back_view(e);if(1===this.history.length)return;this.history.pop(),this.hide_view({key:t.key})}var i=this.history[this.history.length-1];i&&this.show_view({key:i.key})},swap_view:function(e){var t=this.history.pop();t&&this.hide_view({key:t.key});var i=n.find(this.views,{key:e.key});i&&(this.history.push(i),this.show_view(e))},show_view:function(e){var t=n.find(this.views,{key:e.key});t&&(t.instance||(t.instance=t.ctor.create({el:t.el,controller:this})),t.instance.load(e,function i(){t.instance.show(),t.instance.set_visible(!0),t.instance.ready(),e.done&&e.done()}.bind(this)))},hide_view:function(e){var t=n.find(this.views,{key:e.key});t&&(t.instance.hide(),t.instance.set_visible(!1),t.instance.unload(),e.done&&e.done())}})}),define(module,function(e,t,i){var n=t("qp-utility");i({ns:"Model",set_members:function(e){n.each_own(e,function(e,t){this.set_member(t,e)}.bind(this))},set_member:function(e,t){t&&(this[e]=t,this[e+"_id"]=t.id)}})}),define(module,function(e,t,i){var n=t("qp-utility"),a=t("qp-view/view"),s=t("qp-view/controller");i({ns:"qp-view/viewmodel",view:null,controller:null,visible:!1,item_key:"",list_key:"",controls:[],init:function(e){e=n.options(e,{auto:!0,bind:!0,draw:!0}),this.view=a.create({model:this,element:e.el||e.element,auto:e.auto,bind:e.bind,update_view:e.draw})},setup:function(){},load:function(e,t){t()},get_data:function(e){},show:function(){},ready:function(){},requery:function(e){this.get_data(e)},hide:function(){},unload:function(){},reset:function(){},view_controller:function(e){this.controller=s.create(e.controller),this.controller&&n.each(e.views,this.controller.add_view)},next:function(e){this.controller.next_view(e)},back:function(e){this.controller.back_view(e)},set_visible:function(e){this.visible=e,this.draw()},draw:function(e){this.view.update_view(e)},read:function(e){this.view.update_model(e)},set_data:function(e,t){n.merge(this,e),this.draw(),n.invoke_next(t)}})});