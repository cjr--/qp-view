define(module,function(e,t,n){var i=t("qp-utility");n({ns:"qp-view/view",element:null,model:null,node:null,init:function(e){debug("view.init",this.model.self.ns,"->",e.element),this.model=e.model,this.element=i.element(e.el||e.element),this.node={element:this.element,bindings:[]},(e.auto||e.bind)&&this.bind(),(e.auto||e.bind&&e.update_view)&&this.update_view()},bind:function(){this.parse(this.node)},update_view:function(e){this.sync("view",this.node,this.model,e)},update_model:function(e){this.sync("model",this.node,this.model,e)},sync:function(e,t,n,a){a&&t.name!==a||(a=null,i.each(t.bindings,function(t){t["update_"+e].call(this,n)},this)),i.each(t.children,function(s,l){if(t.each){var o=i.find(t.bindings,{name:"each"});n[o.item_name]=n[o.path][l]}this.sync(e,s,n,a),t.each&&i["delete"](n,o.item_name)},this)},parse:function(e){return i.has_attr(e.element,"v-view")?(debug("view.bind @",i.attr(e.element,"v-view")),e.element.removeAttribute("v-view"),e):(this.parse_node(e),e.element.parentNode&&(e.children=i.select(i.to_array(e.element.children),function(t){if(i.is_element(t)){if(!t.hasAttribute("v-each"))return this.parse({element:t,bindings:[]});e.parent=e.element,e.element=t,e.each=!0,this.parse_node(e)}},this)),e)},parse_node:function(e){i.each(i.get_attributes(e.element),function(t){if("v-"===t.name.slice(0,2)){var n=this.create_binding(e,t);if(e.element.removeAttribute(n.key),"node"===n.name)e.name=n.path;else if("if"===n.name)n.type="if";else if(i["in"](n.name,"show","hide"))n.type="visible",n.show="show"===n.name,n.hide=!n.show;else if(i["in"](n.name,"readonly","disabled"))n.attribute=n.name,n["boolean"]=!0;else if("text"===n.name)n.property="textContent";else if("html"===n.name)n.property="innerHTML";else if("value"===n.name)n.property="value";else if("template"===n.name)n.type="template";else if("each"===n.name){var a=n.path.split(" in ");n.item_name=a[0],n.path=a[1],n.template=e.parent.removeChild(e.element),e.element=e.parent,delete e.parent}else"add-class"===n.name?n.type="add_class":i.match(n.name,"on-*")?(n.type="on",n.event=n.name.slice(3)):i.match(n.name,"class-*")?(n.type="class",n["class"]=n.name.slice(6)):i.match(n.name,"style-*")?(n.type="style",n.style=n.name.slice(6)):n.attribute=n.type;n.ignore||(n.property?this.property(n,e.element):n.attribute?this.attribute(n,e.element):"each"===n.name?this.each(n,e):this[n.type](n,e.element))}}.bind(this))},create_binding:function(e,t){var n=t.name.slice(2),a={key:t.name,name:n,type:n,path:t.value,negate:!1,priority:99};return i.match(a.path,"not *")&&(a.path=t.value.slice(4),a.negate=!0),i.match(a.path,"app.*")&&(a.path="global."+a.path),i["in"](a.type,"node","page")?e.ignore=!0:e.bindings.push(a),a},"if":function(e,t){e.priority=1},visible:function(e,t){e.update_view=function(n){var a=i.get(n,e.path);e.show&&a||e.hide&&!a?i.show(t):i.hide(t)},e.update_model=function(n){i.set(n,e.path,"block"===t.style.display&&e.show)}},"class":function(e,t){e.update_view=function(n){i.get(n,e.path)?i.add_class(t,e["class"]):i.remove_class(t,e["class"])},e.update_model=function(n){i.set(n,e.path,i.has_class(t))}},add_class:function(e,t){e.update_view=function(n){i.add_class(t,i.get(n,e.path))},e.update_model=function(e){}},style:function(e,t){e.update_view=function(n){i.set_style(t,e.style,i.get(n,e.path))},e.update_model=function(n){i.set(n,e.path,i.get_style(t,e.style))}},template:function(e,t){e.update_view=function(n){t.textContent=i.format(e.path,n)},e.update_model=function(e){}},property:function(e,t){e.update_view=function(n){t[e.property]=i.get(n,e.path)},e.update_model=function(n){i.set(n,e.path,t[e.property])}},attribute:function(e,t){e["boolean"]?(e.update_view=function(n){i.get(n,e.path)?t.setAttribute(e.attribute):t.removeAttribute(e.attribute)},e.update_model=function(n){i.set(n,e.path,t.hasAttribute(e.attribute))}):(e.update_view=function(n){t.setAttribute(e.attribute,i.get(n,e.path))},e.update_model=function(n){i.set(n,e.path,t.getAttribute(e.attribute))})},on:function(e,t){e.update_view=function(n){e.bound||(i["in"](e.event,"keyup","keydown")?e.event_listener=function(t){i.get(n,e.path).call(n,t)}:i["in"](e.event,"submit")?e.event_listener=function(t){return i.nodefault(t),i.get(n,e.path).call(n,t.target),!1}:i["in"](e.event,"click")&&(e.event_listener=function(a){i.nodefault(a);var s=t.getAttribute("data-id");s||(s=i.parents_until(a.target,t,function(e){return e.getAttribute("data-id")})),i.get(n,e.path).call(n,Number(s))}),i.on(t,e.event,e.event_listener||i.noop),e.bound=!0)},e.update_model=function(e){}},each:function(e,t){var n=t.element;e.update_view=function(a){n.innerHTML="",t.children=i.map(i.get(a,e.path),function(t){var i=e.template.cloneNode(!0);return i.setAttribute("data-id",t.id),n.appendChild(i),this.parse({element:i,bindings:[]})},this)},e.update_model=function(e){}}})}),define(module,function(e,t,n){var i=t("qp-utility"),a=t("qp-view/view");n({ns:"qp-view/viewmodel",view:null,visible:!1,controls:[],init:function(e){e=i.options(e,{bind:!0,draw:!0}),this.view=a.create({model:this,element:e.el||e.element,bind:e.bind,update_view:e.draw})},set_visible:function(e){this.visible!==e&&(this.visible=e,this.draw())},show:function(){this.visible=!0,this.draw()},hide:function(){this.visible=!1,this.draw()},draw:function(e){this.view.update_view(e)},read:function(e){this.view.update_model(e)},control:function(e,t){if(i.is(e,"string")){if(!i.is(t,"object"))return i.find(this.controls,{id:e})}else i.is(e,"array")||i.is(e,"object")}})});